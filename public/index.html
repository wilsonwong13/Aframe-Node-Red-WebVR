<!DOCTYPE html>
<html>
    <head>
        <script src="./combined.js"></script>
        <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
    </head>
    <body>
        <a-scene debug keyboard-shortcuts="enterVR: false; resetSensor: false">
            <a-assets>
                <canvas id="app" width="1024" height="512"></canvas>
            </a-assets>
            <a-sun-sky sun-position-setter>
                <a-entity id="orbit">
                  <a-animation attribute="rotation" from="0 0 0" to="0 360 0" dur="3600000" repeat="indefinite" easing="linear"></a-animation>
                </a-entity>
            </a-sun-sky>
            <a-video src="#app" width="1" height="0.5" position="0 1.5 -0.75" transparent="false" opacity="0.5"></a-video>
            <a-entity id="keyboard" scale="0.01 0.01 0.01" position="-0.15 1.4 -0.44"></a-entity>
            <!-- <a-plane rotation="270 0 0" width="100" height="100" color="#7BC8A4"></a-plane> -->
            <!-- <a-sky color="#ececec"></a-sky> -->
            <a-entity position="0 1.6 -0.2" rotation="-15 0 0">
                <a-camera position="0 0 0" user-height="0" wasd-controls="enabled: false"></a-camera>
            </a-entity>
        </a-scene>
    </body>
    <script type="text/javascript">
      var totalString = ''

      function makingRequestToIBM(str) {
        $.ajax({
          method: "POST",
          url: "https://wilsonwongnodered.mybluemix.net/aframe",
          xhrFields: {
            withCredentials: false
          },
          data: { "msgdata": str},
          dataType: "json",
          beforeSend: function() {
            console.log('Sending message')
          },
          success: function(results) {
          let respone = new KeyboardEvent("keypress", {bubbles : true, cancelable : true, key : 'IBM Watson: ' + results.text[0], char : "", shiftKey : true});
          let enter = new KeyboardEvent("keydown", {bubbles : true, cancelable : true, key : "Enter", code: "Enter", char : "", shiftKey : true});
          if(results.text[0].indexOf('make') > 0) {
            createAShape(results.text[0].slice(results.text[0].indexOf(':') + 2))
          }else if(results.text[0].indexOf('spinning') > 0) {
            console.log(results.text[0].slice(results.text[0].indexOf('spinning') + 'spinning'.length))
            addingProp(results.text[0].slice(results.text[0].indexOf('spinning') + 'spinning'.length + 2))
          } else if(results.text[0].indexOf('animations') > 0) {
            let str = results.text[0].slice(results.text[0].indexOf(':') + 2)
            addingProp(str)
          }
          document.body.dispatchEvent(respone)
          document.body.dispatchEvent(enter)
          },
          error: function(xhr, textStatus, error) {
            console.log(xhr.statusText);
            console.log(textStatus);
            console.log(error);
          }
        })
      }


      function addingProp(str) {
        const action = str.slice(0, str.indexOf('to')).trim()
        const id = str.slice(str.indexOf('to') + 2).trim().replace(/\s/g, '')
        switch(action) {
          case "rotating":
            addingSpinng(id)
            break;
          case "changing position":
            changingPosition(id)
            break;
          case "changing scale":
            console.log('THIS IS SCALE')
            break;
          case "changing color":
            console.log('THIS IS COLOR CHANGE')
            break;
          case "becoming invisible":
            console.log('THIS is INVISIBLE')
            break;
          default:
            console.log('ERROR for SWITCH CASE')
        }
      }

      function addingSpinng(id) {
        $(`#${id}`).append(`<a-animation attribute="rotation" repeat="indefinite" to="0 360 0">`)
      }

      function changingPosition(id) {
        $(`#${id}`).append(`<a-animation attribute="position" from="-2.18 1 -2.04" to="1 1 1"></a-animation>`)
      }

      function changingColor(id) {

      }

      function becomingInvis(id) {

      }

      function changingScale(id) {

      }

      function createAShape(str) {
        let spec = str.split(' ')
        const color = spec[0]
        const shape = spec[1]
        let entity = document.createElement('a-entity');
        entity.setAttribute("id", color+shape)
        entity.setAttribute("geometry", `primitive: ${shape};`)
        entity.setAttribute("material", `color: ${color};`)
        entity.setAttribute("position", '-2.18 1 -2.04')
        document.querySelector('a-scene').appendChild(entity)
      }

      makingRequestToIBM('Hello')
      window.addEventListener('keydown', keepingTrack);

      function keepingTrack(event) {
        if(event.key === "Enter") {
          if(totalString.toLowerCase() === 'restart') {
            location.reload();
          }
          makingRequestToIBM(totalString)
          totalString = ''
        } else if(event.key === "Backspace") {
          totalString = totalString.substring(0, totalString.length -1)
          console.log(totalString)
        } else if(event.key.length === 1) {
          totalString += event.key
        }
      }
    </script>
</html>
